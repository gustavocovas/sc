<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Perlin Noise</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <canvas id="perlin" width="500" height="500"></canvas>

    <script src="noise.js"></script>
    <script>
      const WORLD_WIDTH = 50;
      const WORLD_HEIGHT = 50;
      const CELL_SIZE = 10;
      const NOISE_SCALE = 5;

      let world = [];
      let noise;

      let canvas = document.querySelector("#perlin");
      let context = canvas.getContext("2d");

      start();

      function start() {
        init_world();
        update();
      }

      function init_world() {
        for (var i = 0; i < WORLD_HEIGHT; i++) {
          world[i] = [];
        }

        for (var i = 0; i < WORLD_HEIGHT; i++) {
          for (var j = 0; j < WORLD_WIDTH; j++) {
            world[i][j] = { x: j * CELL_SIZE, y: i * CELL_SIZE, type: "land" };
          }
        }

        noise = new Noise(WORLD_WIDTH, WORLD_HEIGHT, NOISE_SCALE);
      }

      function update() {
        context.clearRect(0, 0, canvas.width, canvas.height);

        for (var i = 0; i < WORLD_HEIGHT; i++) {
          for (var j = 0; j < WORLD_WIDTH; j++) {
            const cell = world[i][j];

            context.beginPath();
            context.rect(cell.x, cell.y, CELL_SIZE, CELL_SIZE);

            let alpha = (1 + noise.at(i, j)) / 2;
            console.log("alpha", alpha);

            // if (alpha > 0.55) {
            //   context.fillStyle = "white";
            // } else {
            //   context.fillStyle = "black";
            // }

            context.fillStyle = "rgba(0, 0, 0, " + alpha + ")";
            context.fill();
          }
        }

        // requestAnimationFrame(update);
      }
    </script>
  </body>
</html>
